# Agent Thinking Display System - Architecture Diagram

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     STREAMLIT APP                                    â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ AI Search Page (ai_search_page.py)                          â”‚     â”‚
â”‚  â”‚                                                              â”‚     â”‚
â”‚  â”‚  1. User enters query                                       â”‚     â”‚
â”‚  â”‚  2. Initialize initial_state with thinking_updates: []      â”‚     â”‚
â”‚  â”‚  3. Run graph.invoke(state)                                 â”‚     â”‚
â”‚  â”‚  4. Capture response.get("thinking_updates")               â”‚     â”‚
â”‚  â”‚  5. Display thinking process                               â”‚     â”‚
â”‚  â”‚  6. Display answer                                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                 â†“                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Thinking Display Component (thinking_display.py)           â”‚     â”‚
â”‚  â”‚                                                              â”‚     â”‚
â”‚  â”‚  â€¢ render_thinking_inline()                                â”‚     â”‚
â”‚  â”‚  â€¢ render_thinking_expandable()                            â”‚     â”‚
â”‚  â”‚  â€¢ render_thinking_session()                               â”‚     â”‚
â”‚  â”‚  â€¢ get_status_icon() â†’ ğŸ” âš™ï¸ ğŸ“š âœï¸ ğŸ§  âœ… âŒ             â”‚     â”‚
â”‚  â”‚  â€¢ get_status_color() â†’ blue, purple, red, green, etc      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LANGGRAPH EXECUTION                              â”‚
â”‚                                                                       â”‚
â”‚  graph.invoke(initial_state) flows through nodes:                   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ analyze_query() - Query Analyzer                            â”‚    â”‚
â”‚  â”‚   â”œâ”€ emit.emit_analyzing()                                  â”‚    â”‚
â”‚  â”‚   â”œâ”€ emit.emit_processing()                                 â”‚    â”‚
â”‚  â”‚   â””â”€ emit.emit_complete() or emit.emit_error()             â”‚    â”‚
â”‚  â”‚   â””â”€ return { ..., "thinking_updates": [...] }             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ generate_clarification() OR rewrite_query()                 â”‚    â”‚
â”‚  â”‚ Clarification Agent / Query Rewriter                        â”‚    â”‚
â”‚  â”‚   â”œâ”€ emit.emit_processing()                                 â”‚    â”‚
â”‚  â”‚   â””â”€ emit.emit_complete()                                   â”‚    â”‚
â”‚  â”‚   â””â”€ return { ..., "thinking_updates": [...] }             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ retrieve() - Document Retriever                             â”‚    â”‚
â”‚  â”‚   â”œâ”€ emit.emit_retrieving()                                 â”‚    â”‚
â”‚  â”‚   â”œâ”€ emit.emit_processing()                                 â”‚    â”‚
â”‚  â”‚   â””â”€ emit.emit_complete()                                   â”‚    â”‚
â”‚  â”‚   â””â”€ return { ..., "thinking_updates": [...] }             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚           â†“                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ generate() - Answer Generator                               â”‚    â”‚
â”‚  â”‚   â”œâ”€ emit.emit_reasoning()                                  â”‚    â”‚
â”‚  â”‚   â”œâ”€ emit.emit_generating()                                 â”‚    â”‚
â”‚  â”‚   â””â”€ emit.emit_complete()                                   â”‚    â”‚
â”‚  â”‚   â””â”€ return { ..., "thinking_updates": [...] }             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                       â”‚
â”‚  Final state.thinking_updates = [                                    â”‚
â”‚    ThinkingUpdate(agent="Query Analyzer", status="ANALYZING", ...),  â”‚
â”‚    ThinkingUpdate(agent="Query Analyzer", status="PROCESSING", ...), â”‚
â”‚    ThinkingUpdate(agent="Query Analyzer", status="COMPLETE", ...),   â”‚
â”‚    ThinkingUpdate(agent="Query Rewriter", status="PROCESSING", ...), â”‚
â”‚    ...                                                               â”‚
â”‚    ThinkingUpdate(agent="Answer Generator", status="COMPLETE", ...), â”‚
â”‚  ]                                                                   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      THINKING SYSTEM (thinking.py)                  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ThinkingUpdate Dataclass                                     â”‚   â”‚
â”‚  â”‚  â€¢ agent_name: str                                           â”‚   â”‚
â”‚  â”‚  â€¢ status: ThinkingStatus (enum)                             â”‚   â”‚
â”‚  â”‚  â€¢ phase_title: str                                          â”‚   â”‚
â”‚  â”‚  â€¢ details: str                                              â”‚   â”‚
â”‚  â”‚  â€¢ progress: float (0.0-1.0)                                â”‚   â”‚
â”‚  â”‚  â€¢ metadata: Dict[str, Any]                                 â”‚   â”‚
â”‚  â”‚  â€¢ timestamp: str (ISO format)                              â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  Methods:                                                     â”‚   â”‚
â”‚  â”‚  â€¢ to_dict() â†’ JSON-serializable                            â”‚   â”‚
â”‚  â”‚  â€¢ to_json() â†’ JSON string                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ThinkingEmitter Class - Helper for agents                   â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  emitter = ThinkingEmitter("Agent Name")                     â”‚   â”‚
â”‚  â”‚  emitter.emit_analyzing("Title", details="..", progress=0.5)â”‚   â”‚
â”‚  â”‚  emitter.emit_processing("Title", ...)                       â”‚   â”‚
â”‚  â”‚  emitter.emit_retrieving("Title", ...)                       â”‚   â”‚
â”‚  â”‚  emitter.emit_generating("Title", ...)                       â”‚   â”‚
â”‚  â”‚  emitter.emit_reasoning("Title", ...)                        â”‚   â”‚
â”‚  â”‚  emitter.emit_complete("Title", ...)                         â”‚   â”‚
â”‚  â”‚  emitter.emit_error("Title", details="..", ...)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ThinkingStatus Enum                                          â”‚   â”‚
â”‚  â”‚  â€¢ ANALYZING (ğŸ” blue)                                       â”‚   â”‚
â”‚  â”‚  â€¢ PROCESSING (âš™ï¸ purple)                                    â”‚   â”‚
â”‚  â”‚  â€¢ RETRIEVING (ğŸ“š red)                                       â”‚   â”‚
â”‚  â”‚  â€¢ GENERATING (âœï¸ green)                                     â”‚   â”‚
â”‚  â”‚  â€¢ REASONING (ğŸ§  orange)                                     â”‚   â”‚
â”‚  â”‚  â€¢ COMPLETE (âœ… dark green)                                  â”‚   â”‚
â”‚  â”‚  â€¢ ERROR (âŒ dark red)                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ThinkingSession Class - Track complete session               â”‚   â”‚
â”‚  â”‚  â€¢ query: str                                                â”‚   â”‚
â”‚  â”‚  â€¢ updates: List[ThinkingUpdate]                             â”‚   â”‚
â”‚  â”‚  â€¢ active_agent: Optional[str]                               â”‚   â”‚
â”‚  â”‚  â€¢ timestamp_start, timestamp_end                            â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  Methods:                                                     â”‚   â”‚
â”‚  â”‚  â€¢ add_update(update) â†’ Add to session                       â”‚   â”‚
â”‚  â”‚  â€¢ complete() â†’ Mark finished                                â”‚   â”‚
â”‚  â”‚  â€¢ get_agent_updates(agent_name) â†’ Filter by agent           â”‚   â”‚
â”‚  â”‚  â€¢ to_dict() â†’ JSON-serializable                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Display Timeline

```
BEFORE (Old):
    User Input
         â†“
    [Spinner] "Thinking..."
         â†“
    Answer

AFTER (New):
    User Input
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ§  Agent Thinking Process                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ ğŸ” Analyzing query clarity and intent       â”‚
    â”‚    Query Analyzer: Evaluating question...   â”‚
    â”‚                                              â”‚
    â”‚ âš™ï¸ Rewriting query for clarity              â”‚
    â”‚    Query Rewriter: Optimized question...    â”‚
    â”‚                                              â”‚
    â”‚ ğŸ“š Searching knowledge base                 â”‚
    â”‚    Document Retriever: Finding documents... â”‚
    â”‚                                              â”‚
    â”‚ ğŸ§  Reasoning over retrieved documents       â”‚
    â”‚    Answer Generator: Analyzing sources...   â”‚
    â”‚                                              â”‚
    â”‚ âœï¸ Generating comprehensive answer          â”‚
    â”‚    Answer Generator: Synthesizing...        â”‚
    â”‚                                              â”‚
    â”‚ âœ… Answer generation complete               â”‚
    â”‚    Answer Generator: Synthesized response...â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    Answer
```

## State Flow

```
INITIAL STATE (from ai_search_page.py):
{
    "messages": [HumanMessage(...)],
    "question": "How do orchids grow?",
    "documents": [],
    "generation": "",
    "query_analysis": None,
    "needs_clarification": False,
    "clarification_response": None,
    "thinking_updates": []  â† Empty at start
}
         â†“
    [graph.invoke(state)]
         â†“
FINAL STATE (after all nodes execute):
{
    "messages": [...],
    "question": "...",
    "documents": [SearchResult(...), ...],
    "generation": "Full answer text...",
    "query_analysis": {...},
    "needs_clarification": False,
    "clarification_response": None,
    "thinking_updates": [  â† FILLED WITH UPDATES
        ThinkingUpdate(...),  # Query Analyzer: ANALYZING
        ThinkingUpdate(...),  # Query Analyzer: PROCESSING
        ThinkingUpdate(...),  # Query Analyzer: COMPLETE
        ThinkingUpdate(...),  # Query Rewriter: PROCESSING
        ThinkingUpdate(...),  # Query Rewriter: COMPLETE
        ThinkingUpdate(...),  # Document Retriever: RETRIEVING
        ThinkingUpdate(...),  # Document Retriever: PROCESSING
        ThinkingUpdate(...),  # Document Retriever: COMPLETE
        ThinkingUpdate(...),  # Answer Generator: REASONING
        ThinkingUpdate(...),  # Answer Generator: GENERATING
        ThinkingUpdate(...),  # Answer Generator: COMPLETE
    ]
}
         â†“
    Display in Streamlit
```

## Component Relationship

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Agent Nodes        â”‚
                    â”‚  (graph.py)         â”‚
                    â”‚                     â”‚
                    â”‚  â€¢ analyze_query    â”‚
                    â”‚  â€¢ rewrite_query    â”‚
                    â”‚  â€¢ retrieve         â”‚
                    â”‚  â€¢ generate         â”‚
                    â”‚  â€¢ ...              â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ emit updates
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ThinkingEmitter    â”‚
                    â”‚  (thinking.py)      â”‚
                    â”‚                     â”‚
                    â”‚  Helper class       â”‚
                    â”‚  Creates            â”‚
                    â”‚  ThinkingUpdate     â”‚
                    â”‚  objects            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ appends to
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  AgentState         â”‚
                    â”‚  thinking_updates[] â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ returns
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  UI Page            â”‚
                    â”‚  (ai_search_page)   â”‚
                    â”‚                     â”‚
                    â”‚  Extracts updates   â”‚
                    â”‚  Passes to renderer â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ calls
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Display Component  â”‚
                    â”‚  (thinking_display) â”‚
                    â”‚                     â”‚
                    â”‚  â€¢ render_thinking_ â”‚
                    â”‚    inline()         â”‚
                    â”‚  â€¢ render_thinking_ â”‚
                    â”‚    expandable()     â”‚
                    â”‚  â€¢ render_thinking_ â”‚
                    â”‚    session()        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ renders
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Streamlit Widget   â”‚
                    â”‚  (st.markdown,      â”‚
                    â”‚   st.progress,      â”‚
                    â”‚   st.json, etc)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Browser Display    â”‚
                    â”‚  (User sees it!)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Feature Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature                         â”‚ Agent   â”‚ Display  â”‚ User Impact â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Status Icons                    â”‚ âœ…      â”‚ âœ…       â”‚ Visual cues â”‚
â”‚ Agent Name Display              â”‚ âœ…      â”‚ âœ…       â”‚ Context     â”‚
â”‚ Progress Tracking               â”‚ âœ…      â”‚ âœ…       â”‚ ETA sense   â”‚
â”‚ Metadata Export                 â”‚ âœ…      â”‚ âœ…       â”‚ Debugging   â”‚
â”‚ Error Capture                   â”‚ âœ…      â”‚ âœ…       â”‚ Debugging   â”‚
â”‚ Multi-Agent Grouping            â”‚ âœ…      â”‚ âœ…       â”‚ Clarity     â”‚
â”‚ JSON Serialization              â”‚ âœ…      â”‚ âœ…       â”‚ Storage     â”‚
â”‚ History Replay                  â”‚ âœ…      â”‚ âœ…       â”‚ Learning    â”‚
â”‚ Customizable Display            â”‚ âŒ      â”‚ âœ…       â”‚ Flexibility â”‚
â”‚ Real-time Streaming             â”‚ âŒ      â”‚ âŒ       â”‚ Future      â”‚
â”‚ Database Persistence            â”‚ âŒ      â”‚ âŒ       â”‚ Future      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
